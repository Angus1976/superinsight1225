# i18n 翻译规则已添加

**日期**: 2026-01-25  
**状态**: ✅ 完成

---

## 📝 新增规则文档

已创建 `.kiro/steering/i18n-translation-rules.md` - 完整的 i18n 翻译规范文档

### 文档位置

```
.kiro/steering/i18n-translation-rules.md
```

这个文档将作为 Kiro 的 steering 规则，在未来的开发中自动提供指导。

---

## 🎯 规则总结

基于 2026-01-25 修复的翻译问题，总结了以下核心规则：

### 规则 1: 区分对象和字符串类型

**问题**: 代码使用 `t('systemMonitoring')` 期望字符串，但翻译文件中是对象

**解决方案**:
- ✅ 对象类型: 使用 `t('systemMonitoring.title')` 访问子键
- ✅ 字符串类型: 直接使用 `t('save')`

**检查清单**:
- [ ] 翻译文件中的键是对象还是字符串？
- [ ] 代码中的使用方式是否匹配类型？
- [ ] 如果是对象，是否使用了正确的子键路径？

### 规则 2: 避免重复翻译键

**问题**: 英文翻译文件中存在重复键定义

**解决方案**:
- ✅ 添加翻译键前先搜索检查
- ✅ 使用工具检测重复键
- ✅ 保持所有语言文件结构一致

**检查命令**:
```bash
# 检测重复键
cat frontend/src/locales/zh/admin.json | grep -o '"[^"]*":' | sort | uniq -d

# 检查键结构一致性
diff <(jq -S 'keys' frontend/src/locales/zh/admin.json) \
     <(jq -S 'keys' frontend/src/locales/en/admin.json)
```

---

## 📚 规则文档内容

新规则文档包含以下章节：

### 1. 核心规则
- **规则 1**: 区分对象和字符串类型
- **规则 2**: 避免重复翻译键
- **规则 3**: 翻译键命名规范
- **规则 4**: 代码中的翻译使用规范
- **规则 5**: 翻译文件维护流程
- **规则 6**: 翻译文件结构规范

### 2. 开发流程
- 添加新功能时的检查点
- 修改现有功能时的检查点
- 代码审查时的检查点

### 3. 自动化检查
- 提交前检查脚本
- CI/CD 集成示例

### 4. 常见错误模式
- 对象当字符串使用
- 重复键定义
- 不一致的嵌套结构

### 5. 故障排查指南
- "returned an object instead of string" 错误
- 翻译不显示或显示键名
- 语言切换后翻译不更新

### 6. 工具和脚本
- 检测重复键脚本
- 验证键结构一致性脚本
- 查找未使用的翻译键脚本

### 7. 历史问题记录
- 记录了 2026-01-25 的问题和修复方案

---

## 🔧 实用工具脚本

文档中包含了三个实用脚本：

### 1. 检测重复键
```bash
#!/bin/bash
# check-duplicate-keys.sh
for file in frontend/src/locales/*/*.json; do
  duplicates=$(cat "$file" | grep -o '"[^"]*":' | sort | uniq -d)
  if [ -n "$duplicates" ]; then
    echo "❌ Found duplicate keys in $file:"
    echo "$duplicates"
  fi
done
```

### 2. 验证键结构一致性
```bash
#!/bin/bash
# check-key-consistency.sh
zh_keys=$(jq -r 'paths(scalars) | join(".")' frontend/src/locales/zh/admin.json | sort)
en_keys=$(jq -r 'paths(scalars) | join(".")' frontend/src/locales/en/admin.json | sort)
diff <(echo "$zh_keys") <(echo "$en_keys")
```

### 3. 查找未使用的翻译键
```bash
#!/bin/bash
# find-unused-keys.sh
for key in $(jq -r 'paths(scalars) | join(".")' frontend/src/locales/zh/admin.json); do
  if ! grep -rq "t('$key')" frontend/src/; then
    echo "Unused key: $key"
  fi
done
```

---

## 📖 如何使用这个规则

### 作为开发者

1. **开发前阅读**: 在添加或修改翻译时，先查阅规则文档
2. **使用检查清单**: 按照文档中的检查清单逐项验证
3. **运行检查脚本**: 提交代码前运行自动化检查脚本

### 作为 Kiro AI

这个文档位于 `.kiro/steering/` 目录，会作为 steering 规则自动加载：

- 当用户提到 i18n、翻译、国际化相关问题时，参考这个规则
- 在添加或修改翻译代码时，遵循这个规则
- 在代码审查时，使用这个规则检查翻译相关代码

---

## ✅ 规则验证

### 当前问题已修复

- ✅ `systemMonitoring` 和 `securityAudit` 对象类型错误已修复
- ✅ 英文翻译文件中的重复键已删除
- ✅ 前端容器已重建并重启
- ✅ 翻译显示正常

### 未来预防

有了这个规则文档，未来可以：

1. **预防类似问题**: 开发时遵循规则，避免重复错误
2. **快速诊断**: 使用故障排查指南快速定位问题
3. **自动化检查**: 使用提供的脚本自动检测问题
4. **知识传承**: 新团队成员可以快速了解 i18n 最佳实践

---

## 📊 规则覆盖范围

| 方面 | 覆盖内容 |
|------|----------|
| **类型安全** | 对象 vs 字符串，TypeScript 类型定义 |
| **重复检测** | 检测和修复重复键的方法 |
| **命名规范** | camelCase，层级结构，语义化命名 |
| **代码使用** | 正确的 API 调用方式，避免动态拼接 |
| **维护流程** | 添加、修改、删除翻译键的标准流程 |
| **文件结构** | JSON 格式，文件组织，语言同步 |
| **自动化** | 检查脚本，CI/CD 集成 |
| **故障排查** | 常见问题和解决方案 |

---

## 🎓 学习资源

规则文档中包含的参考资料：

- [react-i18next 文档](https://react.i18next.com/)
- [i18next 最佳实践](https://www.i18next.com/principles/fallback)
- [TypeScript i18n 类型安全](https://react.i18next.com/latest/typescript)

---

## 🔄 规则维护

### 更新机制

- 当发现新的问题模式时，更新规则文档
- 在 "历史问题记录" 章节记录每次问题和修复
- 定期审查规则的有效性和完整性

### 反馈渠道

如发现规则不完善或有改进建议：
1. 在团队会议中讨论
2. 提交 issue 或 PR
3. 更新规则文档

---

## 🎉 总结

✅ **规则文档已创建**: `.kiro/steering/i18n-translation-rules.md`

✅ **核心规则**:
1. 区分对象和字符串类型
2. 避免重复翻译键

✅ **实用工具**: 提供了 3 个检查脚本

✅ **完整覆盖**: 从开发到维护的全流程指导

✅ **自动生效**: 作为 Kiro steering 规则自动加载

---

**下次遇到 i18n 问题时，Kiro 会自动参考这个规则文档提供指导！**

---

**创建时间**: 2026-01-25  
**文档路径**: `.kiro/steering/i18n-translation-rules.md`  
**状态**: ✅ 已激活
