; FastAPI Application Process Configuration (Enterprise)
; Priority 300 - Starts after PostgreSQL and Redis

[program:fastapi]
command=/opt/venv/bin/gunicorn src.app:app -w %(ENV_APP_WORKERS)s -k uvicorn.workers.UvicornWorker --bind %(ENV_APP_HOST)s:%(ENV_APP_PORT)s --access-logfile /app/logs/fastapi-access.log --error-logfile /app/logs/fastapi-error.log --log-level info --timeout 120 --keep-alive 5 --max-requests 1000 --max-requests-jitter 100
directory=/app
user=superinsight
autostart=true
autorestart=true
priority=300
startsecs=15
startretries=5
stopwaitsecs=30
stopsignal=TERM
redirect_stderr=false
stdout_logfile=/var/log/supervisor/fastapi.log
stderr_logfile=/var/log/supervisor/fastapi-error.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=PYTHONPATH="/app",DATABASE_URL="postgresql://%(ENV_POSTGRES_USER)s:%(ENV_POSTGRES_PASSWORD)s@localhost:5432/%(ENV_POSTGRES_DB)s",REDIS_URL="redis://localhost:%(ENV_REDIS_PORT)s/0",PROMETHEUS_MULTIPROC_DIR="/app/metrics"

; Dependency on PostgreSQL and Redis
depends_on=postgres,redis
